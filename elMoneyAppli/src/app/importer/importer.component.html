<app-tuto title="<br><br><br><br><br><strong>Les tokens</strong>"
          color="white"
          image=""
          subtitle="Fabriquer vos propres tokens a partir d'un fichier, fixez un prix et vendez-les !"
          background="./assets/img/build.jpg"></app-tuto>

<div class="mainform">

  <h2>Fabriquer vos propres token</h2>
  <app-tuto [if]="files[0].length>0"
            label="Le fichier est stocké dans le réseau IPFS de façon totalement sécurisé. Seul la clé permettant de le reconstituer est embarqué dans le token"></app-tuto>
  <app-hourglass [message]="message"></app-hourglass>

  <div *ngIf="message.length==0" style="width:100%;">

    <mat-vertical-stepper [linear]="true" style="width:90%;display: inline-block;max-width:700px;text-align: left;background: none;">
      <mat-step>
        <form>
          <ng-template matStepLabel>Embarquer dans le token</ng-template>
          <input #csvInput [hidden]="true"
                 type="file" onclick="this.value=null"
                 (change)="import($event,0)"
                 accept="*"/>

          <button mat-raised-button
                  mat-button class="app-button"
                  (click)="csvInput.click()">
            Un fichier
          </button>

          <br><br>
          <span *ngIf="files[0].length>0">'{{filename}}' est caché dans votre token</span>

          <strong *ngIf="files[0].length==0">ou</strong>

          <br>

          <mat-form-field appearance="legacy" class="app-field" *ngIf="files[0].length==0">
            <mat-label>Ecrire un secret</mat-label>
            <input matInput type="text" maxlength="200" [(ngModel)]="secret" [ngModelOptions]="{standalone: true}">
            <mat-hint>un mot de passe, une adresse internet qui ne sera accessible qu'au propriétaire</mat-hint>
          </mat-form-field>
        </form>

      </mat-step>

      <mat-step>
        <form>
          <ng-template matStepLabel>Présentation sur la marketplace</ng-template>
          <button mat-raised-button
                  mat-button class="app-button"
                  (click)="add_visual()">

            <div class="bloc-bouton">
              <span *ngIf="files[1].length>0">Modifier le</span>
              <span *ngIf="files[1].length==0">Ajouter un</span>
              <br>
              visuel
            </div>
          </button>
          <br>


          <div *ngIf="files[1].length>0"  style="text-align: right;width:50%;">
            <img class="mat-elevation-z4"
                 [src]="files[1]"
                 style="max-width:150px;border: white 1px solid">
          </div>

          <br>
          <mat-form-field appearance="legacy" class="app-field">
            <mat-label>Intitulé du token</mat-label>
            <input matInput type="text" maxlength="200" [(ngModel)]="uri" [ngModelOptions]="{standalone: true}">
            <mat-hint>Présenter votre token en quelques mots pour le vendre dans la marketplace</mat-hint>
          </mat-form-field>

          <br><br>

          <mat-form-field appearance="legacy" class="app-field" style="max-width: 200px">
            <mat-label>Prix de vente</mat-label>
            <input matInput type="number" [(ngModel)]="price" [ngModelOptions]="{standalone: true}">
            <span matSuffix>xeGld</span>
          </mat-form-field>

        </form>
      </mat-step>
      <mat-step>

        <ng-template matStepLabel>Distribution</ng-template>
        <mat-slide-toggle [(ngModel)]="reseller"
                          color="primary"
                          (toggleChange)="update_prices()">Revente possible</mat-slide-toggle>
        <br>
        <div *ngIf="reseller">
          <br>
          Le vendeur peut modifier le prix<br>
          <mat-form-field appearance="legacy" class="app-field" style="max-width: 130px">
            <mat-label>Prix minimum</mat-label>
            <input matInput type="number" [(ngModel)]="min_price" [ngModelOptions]="{standalone: true}">
            <span matSuffix>xeGld</span>
          </mat-form-field>
          &nbsp;
          <mat-form-field appearance="legacy" class="app-field" style="max-width: 130px">
            <mat-label>Prix maximum</mat-label>
            <input matInput type="number" min="0" [(ngModel)]="max_price" [ngModelOptions]="{standalone: true}">
            <span matSuffix>xeGld</span>
          </mat-form-field>

          <br>
          <mat-slide-toggle
            color="primary"
            [(ngModel)]="only_owner">le propriétaire peut revendre
          </mat-slide-toggle>
          <br>
          <div>
            <mat-form-field appearance="legacy" class="app-field" style="width: 100%">
              <mat-label>Adresse du distributeur</mat-label>
              <input matInput type="text" [(ngModel)]="reseller_addr" [ngModelOptions]="{standalone: true}">
            </mat-form-field>
            <br>
            <mat-form-field appearance="legacy" class="app-field" style="max-width: 200px">
              <mat-label>Marge</mat-label>
              <input matInput type="number" max="50" min="0" [(ngModel)]="reseller_pourcent" [ngModelOptions]="{standalone: true}">
              <span matSuffix>% du prix</span>
            </mat-form-field>
            &nbsp;
            <button mat-raised-button
                    mat-button class="app-button"
                    (click)="add_seller()">
              Ajouter
            </button>

            <br>

            <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
              <ng-container matColumnDef="address">
                <th mat-header-cell *matHeaderCellDef>Adresse</th>
                <td mat-cell *matCellDef="let element"> {{element.address}} </td>
              </ng-container>
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Nom</th>
                <td mat-cell *matCellDef="let element"> {{element.name}} </td>
              </ng-container>
              <ng-container matColumnDef="marge">
                <th mat-header-cell *matHeaderCellDef>Marge</th>
                <td mat-cell *matCellDef="let element"> {{element.marge}} </td>
              </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

            </table>
            <br>


            <button mat-raised-button
                    mat-button class="app-button"
                    (click)="open_store()">
              Ouvrir le store
            </button>

          </div>


        </div>

        <br>


      </mat-step>

      <mat-step>
        <form>
          <ng-template matStepLabel>Fabrication</ng-template>
          <mat-form-field appearance="legacy" class="app-field" style="max-width: 200px">
            <mat-label>Combien d'exemplaire</mat-label>
            <input matInput type="number" min="1" max="1000" [(ngModel)]="count" [ngModelOptions]="{standalone: true}">
          </mat-form-field>
          <br><br>
          <button mat-raised-button  color="primary"
                  mat-button class="large-button"
                  [disabled]="uri?.length==0 && files[0].length==0"
                  (click)="tokenizer()">
            Fabriquer !
          </button>
        </form>
      </mat-step>


    </mat-vertical-stepper>

    &nbsp;

  </div>

</div>
