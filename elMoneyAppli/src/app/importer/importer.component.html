<app-tuto title="<br><br><br><br><br><strong>Les tokens</strong>"
          color="white"
          image=""
          subtitle="Fabriquer vos propres tokens a partir d'un fichier, fixez un prix et vendez-les !"
          background="./assets/img/build.jpg"></app-tuto>

<div class="mainform">

  <h2>Fabriquer vos propres token</h2>
  <app-tuto [if]="files[0].length>0"
            label="Le fichier est stocké dans le réseau IPFS de façon totalement sécurisé. Seul la clé permettant de le reconstituer est embarqué dans le token"></app-tuto>
  <app-hourglass [message]="message"></app-hourglass>

  <div *ngIf="message.length==0" style="width:100%;">

    <mat-vertical-stepper [linear]="true" style="width:90%;display: inline-block;max-width:700px;text-align: left;background: none;">
      <mat-step>
        <form>
          <ng-template matStepLabel>Embarquer dans le token</ng-template>
          <input #csvInput [hidden]="true"
                 type="file" onclick="this.value=null"
                 (change)="import($event,0)"
                 accept="*"/>

          <button mat-raised-button
                  mat-button class="app-button"
                  (click)="csvInput.click()">
            Un fichier
          </button>

          <br><br>
          <span *ngIf="files[0].length>0">'{{filename}}' est caché dans votre token</span>

          <strong *ngIf="files[0].length==0">ou</strong>

          <br>

          <mat-form-field appearance="fill" class="app-field" *ngIf="files[0].length==0">
            <mat-label>Ecrire un secret</mat-label>
            <input matInput type="text" (focusin)="focus_idx=1" maxlength="200" [(ngModel)]="secret" [ngModelOptions]="{standalone: true}">
            <mat-hint *ngIf="focus_idx==1">un mot de passe, une adresse internet qui ne sera accessible qu'au propriétaire</mat-hint>
          </mat-form-field>
        </form>

      </mat-step>

      <mat-step>
        <form>
          <ng-template matStepLabel>Présentation sur la marketplace</ng-template>
          <button mat-raised-button
                  mat-button class="app-button"
                  (click)="add_visual()">

            <div class="bloc-bouton">
              <span *ngIf="files[1].length>0">Modifier le</span>
              <span *ngIf="files[1].length==0">Ajouter un</span>
              <br>
              visuel
            </div>
          </button>
          <br>


          <div *ngIf="files[1].length>0"  style="text-align: right;width:50%;">
            <img class="mat-elevation-z4"
                 [src]="files[1]"
                 style="max-width:150px;border: white 1px solid">
          </div>

          <br>
          <mat-form-field appearance="fill" class="app-field">
            <mat-label>Intitulé du token</mat-label>
            <input matInput type="text" maxlength="200" [(ngModel)]="uri" [ngModelOptions]="{standalone: true}" (focusin)="focus_idx=2">
            <mat-hint *ngIf="focus_idx==2">Présenter votre token en quelques mots pour le vendre dans la marketplace</mat-hint>
          </mat-form-field>

          <br><br>

          <mat-form-field appearance="fill" class="app-field" style="max-width: 200px">
            <mat-label>Prix de vente</mat-label>
            <input matInput type="number" [(ngModel)]="price" [ngModelOptions]="{standalone: true}" (ngModelChange)="update_prices()">
            <span matSuffix>xeGld</span>
          </mat-form-field>

        </form>
      </mat-step>
      <mat-step>

        <ng-template matStepLabel>Distribution</ng-template>
        <mat-tab-group
          animationDuration="1000ms">
          <mat-tab label="Le propriétaire">
            <br>
            <mat-slide-toggle
              color="primary"
              [(ngModel)]="owner_can_sell">le propriétaire peut revendre
            </mat-slide-toggle>

            <br><br>
            <mat-slide-toggle
              color="primary"
              [(ngModel)]="owner_can_transfer">le propriétaire peut offrir
            </mat-slide-toggle>
          </mat-tab>

          <mat-tab label="Les revendeurs">
            <div *ngIf="dataSource.length==0"><br>Aucun revendeur autorisé</div>
            <br>
            <button mat-raised-button
                    mat-button class="app-button"
                    (click)="add_seller()">
              Ajouter
            </button>

            <br>

            <table mat-table [dataSource]="dataSource"
                   *ngIf="dataSource.data.length>0"
                   class="mat-elevation-z8 app-table">

              <ng-container matColumnDef="Address" style="margin:3px">
                <th mat-header-cell *matHeaderCellDef>Adresse</th>
                <td mat-cell title="Ouvrir un exemple de store"
                    style="cursor: pointer;"
                    *matCellDef="let element" (click)="open_store(element)"> {{element.address.substr(0,10)+'..'}} </td>
              </ng-container>

              <ng-container matColumnDef="name"  style="margin:3px">
                <th mat-header-cell *matHeaderCellDef>Name</th>
                <td mat-cell *matCellDef="let element"> {{element.name}} </td>
              </ng-container>


              <ng-container matColumnDef="delete" style="margin:3px">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element">
                  <mat-icon style="cursor: pointer" title="Enlever le revendeur" (click)="delete_dealer(element)">cancel</mat-icon>&nbsp;
                  <mat-icon style="cursor: pointer" title="Ouvrir un exemple de son store" (click)="open_store(element)">shopping_cart</mat-icon>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

            </table>

            <br>



          </mat-tab>
        </mat-tab-group>

        <br>

        <div *ngIf="owner_can_sell || dataSource.length>0">
          <br>
          Marge autorisé par les revendeurs<br>
          <mat-form-field appearance="fill" class="app-field" style="max-width: 130px">
            <mat-label>Marge minimum</mat-label>
            <input matInput type="number" min="0" [max]="price" [(ngModel)]="min_price" [ngModelOptions]="{standalone: true}" (focusin)="focus_idx=3">
            <span matSuffix>xeGld</span>
          </mat-form-field>
          &nbsp;
          <mat-form-field appearance="fill" class="app-field" style="max-width: 130px">
            <mat-label>Marge maximum</mat-label>
            <input matInput type="number" [min]="price" [(ngModel)]="max_price" [ngModelOptions]="{standalone: true}" (focusin)="focus_idx=4">
            <span matSuffix>xeGld</span>
          </mat-form-field>

          <br>
          <mat-form-field appearance="fill" class="app-field" style="max-width: 200px" *ngIf="max_price>min_price">
            <mat-label>Marge du créateur</mat-label>
            <input matInput type="number" min="0" max="100" [(ngModel)]="miner_ratio" [ngModelOptions]="{standalone: true}" (focusin)="focus_idx=20">
            <span matSuffix>%</span>
            <mat-hint *ngIf="focus_idx==20">Percentage attribué au créateur du token sur le prix augmenté</mat-hint>
          </mat-form-field>

        </div>

        <div>


        </div>


        <br>


      </mat-step>

      <mat-step>
        <form>
          <ng-template matStepLabel>Fabrication</ng-template>
          <mat-form-field appearance="fill" class="app-field" style="max-width: 200px">
            <mat-label>Combien d'exemplaire</mat-label>
            <input matInput type="number" min="1" max="1000" [(ngModel)]="count" [ngModelOptions]="{standalone: true}" (focusin)="focus_idx=10">
            <mat-hint *ngIf="focus_idx==10">Attention le coût de fabrication dépend également du nombre de token fabriqués</mat-hint>
          </mat-form-field>
          <br><br>
          <button mat-raised-button  color="primary"
                  mat-button class="large-button"
                  [disabled]="uri?.length==0 && files[0].length==0"
                  (click)="tokenizer()">
            Fabriquer !
          </button>
        </form>
      </mat-step>


    </mat-vertical-stepper>

    &nbsp;

  </div>

</div>
